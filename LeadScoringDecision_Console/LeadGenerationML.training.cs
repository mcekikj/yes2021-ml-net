﻿// This file was auto-generated by ML.NET Model Builder. 
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Microsoft.ML.Data;
using Microsoft.ML.Trainers.LightGbm;
using Microsoft.ML.Trainers;
using Microsoft.ML;

namespace LeadScoringDecision_Console
{
    public partial class LeadGenerationML
    {
        public static ITransformer RetrainPipeline(MLContext context, IDataView trainData)
        {
            var pipeline = BuildPipeline(context);
            var model = pipeline.Fit(trainData);

            return model;
        }

        /// <summary>
        /// build the pipeline that is used from model builder. Use this function to retrain model.
        /// </summary>
        /// <param name="mlContext"></param>
        /// <returns></returns>
        public static IEstimator<ITransformer> BuildPipeline(MLContext mlContext)
        {
            // Data process configuration with pipeline data transformations
            var pipeline = mlContext.Transforms.ReplaceMissingValues(new []{new InputOutputColumnPair(@"Do Not Email", @"Do Not Email"),new InputOutputColumnPair(@"TotalVisits", @"TotalVisits"),new InputOutputColumnPair(@"Total Time Spent on Website", @"Total Time Spent on Website"),new InputOutputColumnPair(@"Page Views Per Visit", @"Page Views Per Visit"),new InputOutputColumnPair(@"Lead Origin_Landing Page Submission", @"Lead Origin_Landing Page Submission"),new InputOutputColumnPair(@"Lead Origin_Lead Add Form", @"Lead Origin_Lead Add Form"),new InputOutputColumnPair(@"Lead Origin_Lead Import", @"Lead Origin_Lead Import"),new InputOutputColumnPair(@"Lead Origin_Quick Add Form", @"Lead Origin_Quick Add Form"),new InputOutputColumnPair(@"Lead Source_Facebook", @"Lead Source_Facebook"),new InputOutputColumnPair(@"Lead Source_Google", @"Lead Source_Google"),new InputOutputColumnPair(@"Lead Source_Olark Chat", @"Lead Source_Olark Chat"),new InputOutputColumnPair(@"Lead Source_Organic Search", @"Lead Source_Organic Search"),new InputOutputColumnPair(@"Lead Source_Other Sources", @"Lead Source_Other Sources"),new InputOutputColumnPair(@"Lead Source_Reference", @"Lead Source_Reference"),new InputOutputColumnPair(@"Lead Source_Referral Sites", @"Lead Source_Referral Sites"),new InputOutputColumnPair(@"Lead Source_Welingak Website", @"Lead Source_Welingak Website"),new InputOutputColumnPair(@"Last Activity_Email Bounced", @"Last Activity_Email Bounced"),new InputOutputColumnPair(@"Last Activity_Email Link Clicked", @"Last Activity_Email Link Clicked"),new InputOutputColumnPair(@"Last Activity_Email Opened", @"Last Activity_Email Opened"),new InputOutputColumnPair(@"Last Activity_Form Submitted on Website", @"Last Activity_Form Submitted on Website"),new InputOutputColumnPair(@"Last Activity_Olark Chat Conversation", @"Last Activity_Olark Chat Conversation"),new InputOutputColumnPair(@"Last Activity_Other Activity", @"Last Activity_Other Activity"),new InputOutputColumnPair(@"Last Activity_Page Visited on Website", @"Last Activity_Page Visited on Website"),new InputOutputColumnPair(@"Last Activity_SMS Sent", @"Last Activity_SMS Sent"),new InputOutputColumnPair(@"Last Activity_Unreachable", @"Last Activity_Unreachable"),new InputOutputColumnPair(@"Last Activity_Unsubscribed", @"Last Activity_Unsubscribed"),new InputOutputColumnPair(@"Specialization_Business Administration", @"Specialization_Business Administration"),new InputOutputColumnPair(@"Specialization_E-Business", @"Specialization_E-Business"),new InputOutputColumnPair(@"Specialization_E-COMMERCE", @"Specialization_E-COMMERCE"),new InputOutputColumnPair(@"Specialization_Finance Management", @"Specialization_Finance Management"),new InputOutputColumnPair(@"Specialization_Healthcare Management", @"Specialization_Healthcare Management"),new InputOutputColumnPair(@"Specialization_Hospitality Management", @"Specialization_Hospitality Management"),new InputOutputColumnPair(@"Specialization_Human Resource Management", @"Specialization_Human Resource Management"),new InputOutputColumnPair(@"Specialization_IT Projects Management", @"Specialization_IT Projects Management"),new InputOutputColumnPair(@"Specialization_International Business", @"Specialization_International Business"),new InputOutputColumnPair(@"Specialization_Marketing Management", @"Specialization_Marketing Management"),new InputOutputColumnPair(@"Specialization_Media and Advertising", @"Specialization_Media and Advertising"),new InputOutputColumnPair(@"Specialization_Operations Management", @"Specialization_Operations Management"),new InputOutputColumnPair(@"Specialization_Others", @"Specialization_Others"),new InputOutputColumnPair(@"Specialization_Retail Management", @"Specialization_Retail Management"),new InputOutputColumnPair(@"Specialization_Rural and Agribusiness", @"Specialization_Rural and Agribusiness"),new InputOutputColumnPair(@"Specialization_Services Excellence", @"Specialization_Services Excellence"),new InputOutputColumnPair(@"Specialization_Supply Chain Management", @"Specialization_Supply Chain Management"),new InputOutputColumnPair(@"Specialization_Travel and Tourism", @"Specialization_Travel and Tourism"),new InputOutputColumnPair(@"What is your current occupation_Housewife", @"What is your current occupation_Housewife"),new InputOutputColumnPair(@"What is your current occupation_Other", @"What is your current occupation_Other"),new InputOutputColumnPair(@"What is your current occupation_Student", @"What is your current occupation_Student"),new InputOutputColumnPair(@"What is your current occupation_Unemployed", @"What is your current occupation_Unemployed"),new InputOutputColumnPair(@"What is your current occupation_Working Professional", @"What is your current occupation_Working Professional")})      
                                    .Append(mlContext.Transforms.Concatenate(@"Features", new []{@"Do Not Email",@"TotalVisits",@"Total Time Spent on Website",@"Page Views Per Visit",@"Lead Origin_Landing Page Submission",@"Lead Origin_Lead Add Form",@"Lead Origin_Lead Import",@"Lead Origin_Quick Add Form",@"Lead Source_Facebook",@"Lead Source_Google",@"Lead Source_Olark Chat",@"Lead Source_Organic Search",@"Lead Source_Other Sources",@"Lead Source_Reference",@"Lead Source_Referral Sites",@"Lead Source_Welingak Website",@"Last Activity_Email Bounced",@"Last Activity_Email Link Clicked",@"Last Activity_Email Opened",@"Last Activity_Form Submitted on Website",@"Last Activity_Olark Chat Conversation",@"Last Activity_Other Activity",@"Last Activity_Page Visited on Website",@"Last Activity_SMS Sent",@"Last Activity_Unreachable",@"Last Activity_Unsubscribed",@"Specialization_Business Administration",@"Specialization_E-Business",@"Specialization_E-COMMERCE",@"Specialization_Finance Management",@"Specialization_Healthcare Management",@"Specialization_Hospitality Management",@"Specialization_Human Resource Management",@"Specialization_IT Projects Management",@"Specialization_International Business",@"Specialization_Marketing Management",@"Specialization_Media and Advertising",@"Specialization_Operations Management",@"Specialization_Others",@"Specialization_Retail Management",@"Specialization_Rural and Agribusiness",@"Specialization_Services Excellence",@"Specialization_Supply Chain Management",@"Specialization_Travel and Tourism",@"What is your current occupation_Housewife",@"What is your current occupation_Other",@"What is your current occupation_Student",@"What is your current occupation_Unemployed",@"What is your current occupation_Working Professional"}))      
                                    .Append(mlContext.Transforms.Conversion.MapValueToKey(@"Converted", @"Converted"))      
                                    .Append(mlContext.MulticlassClassification.Trainers.LightGbm(new LightGbmMulticlassTrainer.Options(){NumberOfLeaves=89,MinimumExampleCountPerLeaf=38,NumberOfIterations=4,MaximumBinCountPerFeature=1024,LearningRate=0.00102969731298568F,LabelColumnName=@"Converted",FeatureColumnName=@"Features",Booster=new GradientBooster.Options(){SubsampleFraction=1F,FeatureFraction=0.69875215113513F,L1Regularization=3.12252031405755E-08F,L2Regularization=0.138787225374635F}}))      
                                    .Append(mlContext.Transforms.Conversion.MapKeyToValue(@"PredictedLabel", @"PredictedLabel"));

            return pipeline;
        }
    }
}
